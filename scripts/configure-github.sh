#!/bin/bash

# GitHub Repository Configuration Script for GlamMe CI/CD
# This script provides all the necessary commands and values for configuring GitHub repository secrets

set -e

# Configuration
REPO_NAME="ceesartech/Glam-Me"
AWS_REGION="us-east-1"
ACCOUNT_ID="476114151082"
ROLE_ARN="arn:aws:iam::476114151082:role/GlamMe-CICD-Role"

echo "üöÄ GitHub Repository Configuration for GlamMe CI/CD"
echo "=================================================="
echo ""
echo "üìã Repository: https://github.com/$REPO_NAME"
echo ""
echo "üîë REQUIRED GitHub Repository Secrets:"
echo "======================================"
echo ""
echo "Secret Name: AWS_ROLE_ARN"
echo "Secret Value: $ROLE_ARN"
echo ""
echo "Secret Name: AWS_REGION"
echo "Secret Value: $AWS_REGION"
echo ""
echo "Secret Name: ACCOUNT_ID"
echo "Secret Value: $ACCOUNT_ID"
echo ""
echo "üåê GitHub Secrets Configuration:"
echo "==============================="
echo ""
echo "1. MANUAL CONFIGURATION:"
echo "   - Open: https://github.com/$REPO_NAME/settings/secrets/actions"
echo "   - Click: 'New repository secret'"
echo "   - Add each secret above with exact names and values"
echo ""
echo "2. USING GITHUB CLI (if installed):"
echo "   gh secret set AWS_ROLE_ARN --body '$ROLE_ARN' --repo $REPO_NAME"
echo "   gh secret set AWS_REGION --body '$AWS_REGION' --repo $REPO_NAME"
echo "   gh secret set ACCOUNT_ID --body '$ACCOUNT_ID' --repo $REPO_NAME"
echo ""
echo "3. VERIFY SECRETS:"
echo "   gh secret list --repo $REPO_NAME"
echo ""
echo "üìä MONITOR PIPELINE:"
echo "=================="
echo ""
echo "After configuring secrets:"
echo "1. Go to: https://github.com/$REPO_NAME/actions"
echo "2. Check if pipeline is running (should start automatically)"
echo "3. If not running, manually trigger:"
echo "   - Click 'GlamMe CI/CD Pipeline'"
echo "   - Click 'Run workflow'"
echo "   - Select environment: 'dev'"
echo "   - Click 'Run workflow'"
echo ""
echo "‚è±Ô∏è EXPECTED PIPELINE DURATION:"
echo "============================"
echo ""
echo "‚Ä¢ Test & Build: 15-20 minutes"
echo "‚Ä¢ Build & Push: 10-15 minutes"
echo "‚Ä¢ Deploy Infrastructure: 5-10 minutes"
echo "‚Ä¢ Deploy Services: 5-10 minutes"
echo "‚Ä¢ Test Deployment: 2-5 minutes"
echo "‚Ä¢ Total: ~45-60 minutes"
echo ""
echo "‚úÖ SUCCESS CRITERIA:"
echo "==================="
echo ""
echo "‚Ä¢ All jobs complete with green checkmarks"
echo "‚Ä¢ No failed steps in any job"
echo "‚Ä¢ ECR repositories contain new images"
echo "‚Ä¢ ECS cluster shows running services"
echo "‚Ä¢ CloudFormation stack shows CREATE_COMPLETE"
echo ""
echo "üîç TROUBLESHOOTING:"
echo "=================="
echo ""
echo "If pipeline fails:"
echo "1. Check GitHub Actions logs for detailed errors"
echo "2. Verify AWS credentials and permissions"
echo "3. Check CDK synthesis and deployment issues"
echo "4. Review ECS service deployment logs"
echo ""
echo "üìû SUPPORT:"
echo "=========="
echo ""
echo "‚Ä¢ GitHub Actions: https://github.com/$REPO_NAME/actions"
echo "‚Ä¢ AWS Console: https://console.aws.amazon.com/"
echo "‚Ä¢ CloudWatch Logs: Check /ecs/glamme-cluster/*"
echo ""
echo "üéâ READY FOR AUTOMATED DEPLOYMENT!"
echo "=================================="
echo ""
echo "Once secrets are configured, your GlamMe platform will have:"
echo "‚úÖ Automated testing and building"
echo "‚úÖ Docker image creation and ECR push"
echo "‚úÖ Infrastructure deployment with CDK"
echo "‚úÖ ECS service orchestration"
echo "‚úÖ Health checks and monitoring"
echo "‚úÖ Multi-environment support"
echo ""
echo "üöÄ Your CI/CD pipeline is ready to deploy GlamMe automatically!"
